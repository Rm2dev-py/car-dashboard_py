// src/components/GradCpt.tsx
// ðŸ“ˆ Composant statique pour visualiser un SVG fixe sans interaction serveur

import { useEffect, useRef, useState } from "react";

export default function GradCpt() {
  const [position, setPosition] = useState(() => {
    const saved = localStorage.getItem("grad_cpt_position");
    return saved ? JSON.parse(saved) : { x: 100, y: 100 };
  });

  const dragging = useRef(false);
  const offset = useRef({ x: 0, y: 0 });
  const grid = 40;

  const ref = useRef<HTMLDivElement>(null);

  const handleStart = (e: React.MouseEvent | React.TouchEvent) => {
    const clientX = "touches" in e ? e.touches[0].clientX : e.clientX;
    const clientY = "touches" in e ? e.touches[0].clientY : e.clientY;

    const snappedX = Math.round(clientX / grid) * grid;
    const snappedY = Math.round(clientY / grid) * grid;

    offset.current = {
      x: clientX - snappedX,
      y: clientY - snappedY,
    };

    setPosition({ x: snappedX, y: snappedY });
    dragging.current = true;
  };

  const handleMove = (e: MouseEvent | TouchEvent) => {
    if (!dragging.current) return;
    const clientX = "touches" in e ? (e as TouchEvent).touches[0].clientX : (e as MouseEvent).clientX;
    const clientY = "touches" in e ? (e as TouchEvent).touches[0].clientY : (e as MouseEvent).clientY;

    const snappedX = Math.round((clientX - offset.current.x) / grid) * grid;
    const snappedY = Math.round((clientY - offset.current.y) / grid) * grid;
    setPosition({ x: snappedX, y: snappedY });
  };

  const handleEnd = () => {
    dragging.current = false;
  };

  useEffect(() => {
    localStorage.setItem("grad_cpt_position", JSON.stringify(position));
  }, [position]);

  useEffect(() => {
    window.addEventListener("mousemove", handleMove);
    window.addEventListener("mouseup", handleEnd);
    window.addEventListener("touchmove", handleMove);
    window.addEventListener("touchend", handleEnd);
    return () => {
      window.removeEventListener("mousemove", handleMove);
      window.removeEventListener("mouseup", handleEnd);
      window.removeEventListener("touchmove", handleMove);
      window.removeEventListener("touchend", handleEnd);
    };
  }, []);

  return (
    <div
      ref={ref}
      style={{
        position: "absolute",
        top: position.y,
        left: position.x,
        zIndex: 40,
        cursor: "grab",
        touchAction: "none",
      }}
      onMouseDown={handleStart}
      onTouchStart={handleStart}
    >
      <svg
        width="300"
        height="260"
        viewBox="0 0 370 273"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
     <path d="M184.854 19.9089C182.322 19.9089 180.68 18.878 179.93 17.4267C179.74 17.0764 179.66 16.7461 179.66 16.4057C179.66 15.7251 180.09 15.2947 180.811 15.2947C181.341 15.2947 181.661 15.525 181.932 16.0554C182.432 17.1464 183.303 17.797 184.884 17.797C186.526 17.797 187.637 16.8562 187.637 15.545C187.647 14.0036 186.526 13.1428 184.674 13.1428H183.853C183.213 13.1428 182.832 12.7524 182.832 12.1819C182.832 11.6114 183.213 11.2211 183.853 11.2211H184.614C186.205 11.2211 187.266 10.3102 187.266 9.02909C187.266 7.77796 186.446 6.9372 184.844 6.9372C183.483 6.9372 182.692 7.4977 182.212 8.62872C181.932 9.24928 181.651 9.47949 181.051 9.47949C180.33 9.47949 179.95 9.05911 179.95 8.39852C179.95 8.03819 180.02 7.7179 180.2 7.36758C180.881 5.93629 182.482 4.88534 184.834 4.88534C187.827 4.88534 189.749 6.44675 189.749 8.67877C189.749 10.4904 188.457 11.7015 186.716 12.0618V12.1119C188.848 12.3121 190.259 13.5932 190.259 15.605C190.259 18.1673 188.017 19.9089 184.854 19.9089Z" fill="white" fill-opacity="1"/>
<path d="M298.44 57.4266C297.73 57.4266 297.209 56.9661 297.209 56.1554V54.4539H291.514C290.583 54.4539 289.973 53.8633 289.973 53.0026C289.973 52.4421 290.133 51.9716 290.533 51.251C291.544 49.4393 293.186 46.9671 294.917 44.4248C295.858 43.0235 296.489 42.5832 297.55 42.5832C298.881 42.5832 299.672 43.2838 299.672 44.4849V52.332H300.682C301.363 52.332 301.773 52.7724 301.773 53.3929C301.773 54.0235 301.363 54.4539 300.672 54.4539H299.672V56.1554C299.672 56.9661 299.161 57.4266 298.44 57.4266ZM297.249 52.392V44.7451H297.209C294.917 48.0281 293.486 50.19 292.315 52.3219V52.392H297.249Z" fill="white" fill-opacity="1"/>
<path d="M360.34 147.257C358.118 147.257 356.196 146.196 355.486 144.624C355.346 144.314 355.255 144.014 355.255 143.643C355.255 142.973 355.686 142.552 356.366 142.552C356.907 142.552 357.237 142.763 357.507 143.293C357.998 144.464 358.959 145.155 360.35 145.155C362.062 145.155 363.273 143.944 363.273 142.232C363.273 140.571 362.062 139.39 360.36 139.39C359.449 139.39 358.659 139.76 358.108 140.3C357.507 140.901 357.257 141.031 356.667 141.031C355.836 141.031 355.426 140.441 355.446 139.74C355.446 139.68 355.446 139.64 355.456 139.58L355.916 134.125C356.006 132.984 356.587 132.523 357.718 132.523H363.943C364.604 132.523 365.034 132.944 365.034 133.574C365.034 134.215 364.604 134.635 363.943 134.635H358.108L357.728 138.909H357.778C358.388 138.008 359.579 137.448 361.031 137.448C363.793 137.448 365.765 139.4 365.765 142.162C365.765 145.185 363.543 147.257 360.34 147.257Z" fill="white" fill-opacity="1"/>
<path d="M362.642 270.059C360.39 270.059 358.608 268.958 357.607 266.846C357.077 265.735 356.806 264.354 356.806 262.712C356.806 257.898 359.008 255.025 362.682 255.025C364.884 255.025 366.565 255.986 367.286 257.357C367.446 257.648 367.516 257.898 367.516 258.178C367.516 258.769 367.096 259.219 366.415 259.219C365.905 259.219 365.584 258.979 365.184 258.468C364.513 257.548 363.743 257.127 362.672 257.127C360.49 257.127 359.329 259.139 359.279 262.462V262.612H359.329C359.899 261.281 361.34 260.28 363.302 260.28C366.085 260.28 368.036 262.282 368.036 265.014C368.036 267.947 365.764 270.059 362.642 270.059ZM362.602 267.957C364.213 267.957 365.494 266.696 365.494 265.114C365.504 263.453 364.293 262.272 362.632 262.272C360.97 262.272 359.719 263.453 359.719 265.064C359.719 266.686 360.99 267.957 362.602 267.957Z" fill="white" fill-opacity="1"/>
<path d="M9.83429 270.059C6.27107 270.059 4.14915 267.166 4.14915 262.532C4.14915 257.918 6.29109 255.035 9.83429 255.035C13.3675 255.035 15.4994 257.898 15.4994 262.522C15.4994 267.146 13.3875 270.059 9.83429 270.059ZM9.83429 267.947C11.7861 267.947 12.8971 265.955 12.8971 262.532C12.8971 259.149 11.766 257.147 9.83429 257.147C7.89253 257.147 6.7515 259.159 6.7515 262.522C6.7515 265.945 7.87252 267.947 9.83429 267.947Z" fill="white" fill-opacity="1"/>
<path d="M6.79968 151.89C6.049 151.89 5.52853 151.369 5.52853 150.589V139.749H5.47848L3.14638 141.37C2.89615 141.55 2.69597 141.62 2.41572 141.62C1.87523 141.62 1.48488 141.23 1.48488 140.66C1.48488 140.259 1.64502 139.959 2.07541 139.659L5.02808 137.587C5.66866 137.136 6.06902 137.046 6.60951 137.046C7.52033 137.046 8.07083 137.597 8.07083 138.488V150.589C8.07083 151.369 7.55036 151.89 6.79968 151.89Z" fill="white" fill-opacity="1"/>
<path d="M72.6651 57.2264C71.8644 57.2264 71.444 56.786 71.444 56.1354C71.444 55.6349 71.6142 55.3347 72.1647 54.8142L76.5787 50.4402C78.4203 48.6186 78.8807 47.8879 78.8807 46.7869C78.8807 45.4958 77.8898 44.5649 76.4986 44.5649C75.1974 44.5649 74.2866 45.2255 73.7761 46.5267C73.5159 47.0472 73.2156 47.3174 72.6251 47.3174C71.9245 47.3174 71.5041 46.887 71.5041 46.2465C71.5041 46.0563 71.5341 45.8761 71.5842 45.706C71.9745 44.1446 73.7061 42.4931 76.5186 42.4931C79.4112 42.4931 81.403 44.2046 81.403 46.6268C81.403 48.3183 80.5923 49.4594 78.2001 51.8015L74.8871 55.0644V55.1145H80.6523C81.333 55.1145 81.7533 55.5349 81.7533 56.1754C81.7533 56.806 81.333 57.2264 80.6523 57.2264H72.6651Z" fill="white" fill-opacity="1"/>

      </svg>
    </div>
  );
}
